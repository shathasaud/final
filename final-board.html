<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ø§Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ø³Ø¨</title>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
        }

        /* ================================
           GLOBAL STYLES
        =================================*/
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Cairo", sans-serif;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100%;
            padding: 20px;
        }

        html, body {
            height: 100%;
        }

        /* ================================
           HOME PANEL â€“ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        =================================*/
        #panel-home {
            text-align: center;
            background: white;
            padding: 50px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 600px;
            margin: 0 auto;
            margin-top: 50px;
        }

        #panel-home h1 {
            font-size: 36px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            font-weight: 700;
        }

        #panel-home p {
            font-size: 18px;
            color: #555;
            margin-bottom: 20px;
        }

        #panel-home button {
            width: 80%;
            max-width: 350px;
            padding: 18px;
            margin: 12px auto;
            display: block;
            font-size: 20px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        /* ================================
           RESPONSIVE â€“ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„
        =================================*/
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            #panel-home {
                padding: 30px 20px;
                margin-top: 20px;
            }

            #panel-home h1 {
                font-size: 28px;
            }

            #panel-home p {
                font-size: 16px;
                margin-bottom: 30px;
            }

            #panel-home button {
                width: 100%;
                font-size: 18px;
                padding: 15px;
            }

            #panel-teacher,
            #panel-student {
                padding: 15px;
            }

            #panel-teacher h2,
            #panel-student h2 {
                font-size: 24px;
                margin-bottom: 20px;
            }

            .controls {
                flex-direction: column;
                gap: 8px;
            }

            .controls button {
                width: 100%;
                padding: 12px;
                font-size: 15px;
            }

            .stats-bar {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }

            .stat-item {
                width: 100%;
                min-width: auto;
            }

            .class-filter {
                display: flex;
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .class-filter label {
                font-size: 15px;
                margin-left: 0;
                margin-bottom: 5px;
            }

            .class-filter select {
                width: 100%;
                font-size: 14px;
            }

            .class-filter button {
                width: 100%;
                margin-right: 0;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                font-size: 12px;
                min-width: 1200px;
            }

            th {
                padding: 12px 8px;
                font-size: 13px;
            }

            td {
                padding: 10px 8px;
                font-size: 12px;
            }

            .score-input {
                width: 50px;
                padding: 5px;
                font-size: 13px;
            }

            .attendance-input {
                width: 45px;
            }

            .btn-table {
                padding: 6px 10px;
                font-size: 14px;
            }

            .btn-plan,
            .btn-analysis,
            .btn-parent {
                padding: 6px 10px;
                font-size: 12px;
            }

            .popup-box {
                width: 95%;
                padding: 20px;
                max-height: 90%;
                overflow-y: auto;
            }

            .popup-box h3 {
                font-size: 20px;
                margin-bottom: 15px;
            }

            .popup-box input[type="text"],
            .popup-box textarea {
                font-size: 14px;
                padding: 10px;
            }

            .popup-box button {
                padding: 10px 20px;
                font-size: 14px;
                margin: 5px;
            }

            .coop-option {
                padding: 12px;
                font-size: 15px;
            }

            .search-box {
                padding: 0 10px;
            }

            .search-box input {
                width: 100%;
                max-width: none;
                margin-left: 0;
                margin-bottom: 10px;
                font-size: 15px;
            }

            #btn-search-student {
                width: 100%;
                padding: 12px;
                font-size: 16px;
            }

            .info-card {
                padding: 20px;
                margin-bottom: 15px;
            }

            .info-card h3 {
                font-size: 17px;
            }

            .info-card p,
            .info-card span,
            .info-card li {
                font-size: 14px;
            }

            #btn-contact-teacher {
                width: 100%;
                padding: 15px;
                font-size: 16px;
            }

            #btn-back-student {
                font-size: 16px;
            }

            .confirm-dialog {
                width: 95%;
                padding: 20px;
            }

            .confirm-dialog h3 {
                font-size: 20px;
            }

            .confirm-dialog p {
                font-size: 15px;
            }

            .confirm-dialog button {
                padding: 10px 20px;
                font-size: 14px;
                width: 100%;
                margin: 5px 0;
            }

            .toast-message {
                right: 10px;
                left: 10px;
                width: auto;
                font-size: 14px;
                padding: 12px 20px;
            }

            #popup-teacher-login input {
                font-size: 16px !important;
            }

            #analysis-text {
                font-size: 13px;
                padding: 15px;
                line-height: 1.7;
            }
        }

        @media (max-width: 480px) {
            #panel-home h1 {
                font-size: 24px;
            }

            #panel-home p {
                font-size: 14px;
            }

            #panel-teacher h2,
            #panel-student h2 {
                font-size: 20px;
            }

            .stat-item strong {
                font-size: 24px;
            }

            .stat-item span {
                font-size: 12px;
            }

            table {
                min-width: 1100px;
                font-size: 11px;
            }

            th {
                padding: 10px 6px;
                font-size: 12px;
            }

            td {
                padding: 8px 6px;
                font-size: 11px;
            }
        }

        #btn-go-teacher {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        #btn-go-student {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }

        #panel-home button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* ================================
           TEACHER PANEL â€“ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„Ù…Ø©
        =================================*/
        #panel-teacher {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 100%;
            margin: 0 auto;
        }

        #panel-teacher h2 {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            font-size: 30px;
            font-weight: 700;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 25px;
            justify-content: center;
        }

        .controls button {
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }

        #btn-add-student {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
        }

        #btn-save-data {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
        }

        #btn-clear-all {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(250, 112, 154, 0.3);
        }

        #btn-load-demo {
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(251, 194, 235, 0.3);
        }

        #btn-back-home {
            background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(137, 247, 254, 0.3);
        }

        .controls button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-bar {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            background: #f3f4f6;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            justify-content: space-around;
        }

        .stat-item {
            text-align: center;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            min-width: 120px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            transition: transform 0.2s;
        }

        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .stat-item strong {
            display: block;
            font-size: 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .stat-item span {
            font-size: 14px;
            color: #6b7280;
        }

        /* ÙÙ„ØªØ± Ø§Ù„ÙØµÙˆÙ„ */
        .class-filter {
            margin-bottom: 20px;
            text-align: center;
        }

        .class-filter label {
            font-size: 16px;
            font-weight: 600;
            margin-left: 10px;
            color: #374151;
        }

        .class-filter select {
            padding: 10px 15px;
            font-size: 15px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            background: white;
            cursor: pointer;
        }

        .class-filter button {
            padding: 10px 20px;
            margin-right: 10px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 18px 10px;
            font-weight: 700;
            font-size: 15px;
            text-align: center;
            border-bottom: 3px solid rgba(255,255,255,0.2);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
            font-size: 14px;
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        /* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .score-input {
            width: 60px;
            padding: 6px;
            text-align: center;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .attendance-input {
            width: 50px;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .btn-table {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: 0.2s;
        }

        .btn-coop {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            box-shadow: 0 3px 10px rgba(253, 203, 110, 0.4);
        }

        .btn-strength {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
            box-shadow: 0 3px 10px rgba(0, 184, 148, 0.4);
        }

        .btn-excellence {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            box-shadow: 0 3px 10px rgba(108, 92, 231, 0.4);
        }

        .btn-weakness {
            background: linear-gradient(135deg, #fab1a0 0%, #ff7675 100%);
            box-shadow: 0 3px 10px rgba(255, 118, 117, 0.4);
        }

        .btn-table:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .btn-plan {
            background: #3b82f6;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-analysis {
            background: #8b5cf6;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }

        .btn-parent {
            background: #ec4899;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .total-score {
            font-weight: 700;
            font-size: 16px;
            color: #059669;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spinner 0.6s linear infinite;
        }

        @keyframes spinner {
            to { transform: rotate(360deg); }
        }

        /* ================================
           POPUPS â€“ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        =================================*/
        #popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 999;
        }

        .popup-box {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
        }

        .popup-box h3 {
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 24px;
            font-weight: 700;
        }

        .popup-box input[type="text"],
        .popup-box textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 15px;
            margin-bottom: 15px;
            font-family: "Cairo", sans-serif;
        }

        .popup-box textarea {
            min-height: 120px;
            resize: vertical;
        }

        .popup-box button {
            padding: 12px 25px;
            margin-left: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 15px;
        }

        .popup-box button:first-of-type {
            background: #10b981;
            color: white;
        }

        .popup-close {
            background: #6b7280;
            color: white;
        }

        .coop-option {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 15px;
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }

        .coop-option:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        #ai-plan {
            background: #8b5cf6;
            color: white;
        }

        #analysis-text {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-line;
            line-height: 1.8;
            color: #374151;
        }

        /* ================================
           STUDENT PANEL â€“ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø©
        =================================*/
        #panel-student {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 900px;
            margin: 0 auto;
        }

        #panel-student h2 {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            font-size: 30px;
            font-weight: 700;
        }

        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« */
        .search-box {
            text-align: center;
            margin-bottom: 30px;
        }

        .search-box input {
            padding: 12px 20px;
            width: 70%;
            max-width: 400px;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            font-size: 16px;
            margin-left: 10px;
        }

        #btn-search-student {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            padding: 12px 20px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: transform 0.2s;
        }

        #btn-search-student:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        #btn-back-student {
            color: #4A90E2;
            font-weight: 600;
            font-size: 17px;
            background: none;
            border: none;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 20px;
        }

        /* ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        #panel-student div[style*="background:white"] {
            background: #FFFFFF;
            border: 1px solid #E0E6ED;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        #panel-student h3 {
            margin-top: 0;
            color: #2C3E50;
            font-size: 18px;
            margin-bottom: 10px;
        }

        #panel-student p,
        #panel-student span {
            font-size: 15px;
            color: #333;
        }

        #st-strength li,
        #st-excellence li,
        #st-weakness li {
            margin: 5px 0;
            color: #4A4A4A;
            line-height: 1.6;
        }

        #panel-student p span {
            font-weight: 700;
            color: #4A90E2;
        }

        #st-strength,
        #st-excellence,
        #st-weakness,
        #st-plan,
        #st-recommend {
            padding-right: 10px;
            line-height: 1.6;
        }

        .info-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 2px solid rgba(102, 126, 234, 0.15);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }

        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 10000;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .confirm-dialog h3 {
            margin-bottom: 20px;
            color: #ef4444;
            font-size: 22px;
        }

        .confirm-dialog p {
            margin-bottom: 25px;
            color: #666;
            font-size: 16px;
        }

        .confirm-dialog button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: 0.2s;
        }

        .confirm-yes {
            background: #ef4444;
            color: white;
        }

        .confirm-no {
            background: #6b7280;
            color: white;
        }

        .toast-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            z-index: 10000;
            font-weight: 600;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- ================================
     HOME PANEL â€“ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
================================= -->
  <div id="panel-home">
   <h1>ğŸ“ Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø°ÙƒÙŠØ©</h1>
   <p>Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ø§Ù„Ø¨Ø© ÙÙŠ Ù…Ø§Ø¯Ø© ØªÙ‚Ù†ÙŠØ© Ø±Ù‚Ù…ÙŠØ© Ù„Ø¹Ø§Ù… 1447 Ù‡Ù€</p><button id="btn-go-teacher">ğŸ‘©â€ğŸ« Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</button> <button id="btn-go-student">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨Ø©/ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</button>
  </div><!-- ================================
     TEACHER PANEL â€“ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„Ù…Ø©
================================= -->
  <div id="panel-teacher">
   <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…Ø© â€“ Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª</h2><!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
   <div class="controls"><button id="btn-add-student">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨Ø©</button> <button id="btn-load-demo">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button> <button id="btn-clear-all">ğŸ—‘ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button> <button id="btn-back-home">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
   </div><!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
   <div class="stats-bar">
    <div class="stat-item"><strong id="stat-total">0</strong> <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª</span>
    </div>
    <div class="stat-item"><strong id="stat-average">0</strong> <span>Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ù…</span>
    </div>
    <div class="stat-item"><strong id="stat-attendance">0%</strong> <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</span>
    </div>
    <div class="stat-item"><strong id="stat-late">0</strong> <span>ÙˆØ§Ø¬Ø¨Ø§Øª Ù…ØªØ£Ø®Ø±Ø©</span>
    </div>
    <div class="stat-item"><strong id="stat-soon">0</strong> <span>Ù‚Ø±ÙŠØ¨Ø© Ø§Ù„Ù…ÙˆØ¹Ø¯</span>
    </div>
    <div class="stat-item"><strong id="stat-today">0</strong> <span>Ù…Ø·Ù„ÙˆØ¨Ø© Ø§Ù„ÙŠÙˆÙ…</span>
    </div>
   </div><!-- ÙÙ„ØªØ± Ø§Ù„ÙØµÙˆÙ„ -->
   <div class="class-filter"><label>ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„:</label> <select id="class-select"> <option value="">Ø§Ù„ÙƒÙ„</option> <option value="Ø«Ø§Ù„Ø« 1">Ø«Ø§Ù„Ø« 1</option> <option value="Ø«Ø§Ù„Ø« 2">Ø«Ø§Ù„Ø« 2</option> <option value="Ø«Ø§Ù„Ø« 3">Ø«Ø§Ù„Ø« 3</option> </select> <button id="btn-stat-reset">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙÙ„ØªØ±</button>
   </div><!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
   <div class="table-container">
    <table>
     <thead>
      <tr>
       <th>#</th>
       <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</th>
       <th>Ø§Ù„ÙØµÙ„</th>
       <th>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (30)</th>
       <th>Ø§Ù„Ù†Ø´Ø§Ø· (30)</th>
       <th>Ø§Ù„ÙˆØ§Ø¬Ø¨ (20)</th>
       <th>Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø© (20)</th>
       <th>Ø§Ù„ØªØ¹Ø§ÙˆÙ†</th>
       <th>Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</th>
       <th>Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ…ÙŠØ²</th>
       <th>Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</th>
       <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
       <th>Ø®Ø·Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
       <th>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©</th>
       <th>ØªÙˆØ§ØµÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</th>
       <th>Ø§Ù„ØºÙŠØ§Ø¨</th>
      </tr>
     </thead>
     <tbody id="students-body"><!-- ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª Ù‡Ù†Ø§ -->
     </tbody>
    </table>
   </div>
  </div><!-- ================================
     STUDENT PANEL â€“ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø©
================================= -->
  <div id="panel-student">
   <h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø©/ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</h2><!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« -->
   <div class="search-box"><input type="text" id="student-name-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ù„Ù„Ø·Ø§Ù„Ø¨Ø©"> <button id="btn-search-student">ğŸ” Ø¨Ø­Ø«</button>
   </div><!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨Ø© -->
   <div class="info-card">
    <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨Ø©</h3>
    <p><span>Ø§Ù„Ø§Ø³Ù…:</span> <span id="st-name">â€”</span></p>
    <p><span>Ø§Ù„ÙØµÙ„:</span> <span id="st-class">â€”</span></p>
    <p><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</span> <span id="st-total">â€”</span></p>
    <p><span>Ø§Ù„Ø­Ø§Ù„Ø©:</span> <span id="st-status">â€”</span></p>
   </div><!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
   <div class="info-card">
    <h3>ğŸ“Š Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h3>
    <p><span>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (30):</span> <span id="st-exam">â€”</span></p>
    <p><span>Ø§Ù„Ù†Ø´Ø§Ø· (30):</span> <span id="st-activity">â€”</span></p>
    <p><span>Ø§Ù„ÙˆØ§Ø¬Ø¨ (20):</span> <span id="st-homework">â€”</span></p>
    <p><span>Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø© (20):</span> <span id="st-discussion">â€”</span></p>
    <p><span>Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨:</span> <span id="st-attendance">â€”</span></p>
   </div><!-- Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© -->
   <div class="info-card">
    <h3>ğŸ’ª Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</h3>
    <ul id="st-strength"></ul>
   </div><!-- Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ…ÙŠØ² -->
   <div class="info-card">
    <h3>âœ¨ Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ…ÙŠØ²</h3>
    <ul id="st-excellence"></ul>
   </div><!-- Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù -->
   <div class="info-card">
    <h3>âš  Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</h3>
    <ul id="st-weakness"></ul>
   </div><!-- Ø®Ø·Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ -->
   <div class="info-card">
    <h3>ğŸ“ Ø®Ø·Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h3>
    <p id="st-plan">â€”</p>
   </div><!-- ØªÙˆØµÙŠØ§Øª -->
   <div class="info-card">
    <h3>ğŸ’¡ ØªÙˆØµÙŠØ§Øª</h3>
    <p id="st-recommend">â€”</p>
   </div><!-- Ø²Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ --> <button id="btn-contact-teacher" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4); transition: transform 0.2s;"> ğŸ“± Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ </button> <button id="btn-back-student">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </div><!-- ================================
     POPUPS â€“ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
================================= -->
  <div id="popup-overlay"></div><!-- Ù†Ø§ÙØ°Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© -->
  <div class="popup-box" id="popup-strength">
   <h3>ğŸ’ª Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ù‚ÙˆØ©</h3><input type="text" id="strength-input" placeholder="Ø§ÙƒØªØ¨ÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„Ù‚ÙˆØ©"> <button id="save-strength">Ø­ÙØ¸</button> <button class="popup-close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div><!-- Ù†Ø§ÙØ°Ø© Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ…ÙŠØ² -->
  <div class="popup-box" id="popup-excellence">
   <h3>âœ¨ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© ØªÙ…ÙŠØ²</h3><input type="text" id="excellence-input" placeholder="Ø§ÙƒØªØ¨ÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„ØªÙ…ÙŠØ²"> <button id="save-excellence">Ø­ÙØ¸</button> <button class="popup-close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div><!-- Ù†Ø§ÙØ°Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù -->
  <div class="popup-box" id="popup-weakness">
   <h3>âš  Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ø¶Ø¹Ù</h3><input type="text" id="weakness-input" placeholder="Ø§ÙƒØªØ¨ÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¶Ø¹Ù"> <button id="save-weakness">Ø­ÙØ¸</button> <button class="popup-close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div><!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø§ÙˆÙ† -->
  <div class="popup-box" id="popup-coop">
   <h3>ğŸ¤ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªØ¹Ø§ÙˆÙ†</h3><button class="coop-option" data-value="Ù…Ù…ØªØ§Ø²Ø©">Ù…Ù…ØªØ§Ø²Ø©</button> <button class="coop-option" data-value="Ø¬ÙŠØ¯Ø©">Ø¬ÙŠØ¯Ø©</button> <button class="coop-option" data-value="Ù…ØªÙˆØ³Ø·Ø©">Ù…ØªÙˆØ³Ø·Ø©</button> <button class="coop-option" data-value="Ø¶Ø¹ÙŠÙØ©">Ø¶Ø¹ÙŠÙØ©</button> <button class="popup-close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div><!-- Ù†Ø§ÙØ°Ø© Ø®Ø·Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ -->
  <div class="popup-box" id="popup-plan">
   <h3>ğŸ“ Ø®Ø·Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h3><textarea id="plan-input" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ù„Ø®Ø·Ø© Ù‡Ù†Ø§..."></textarea> <button id="ai-plan">ğŸ¤– ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button> <button id="save-plan">Ø­ÙØ¸</button> <button class="popup-close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div><!-- Ù†Ø§ÙØ°Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© -->
  <div class="popup-box" id="popup-analysis">
   <h3>ğŸ” ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø©</h3>
   <div id="analysis-text"></div><button class="popup-close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div><!-- Ù†Ø§ÙØ°Ø© ØªÙˆØ§ØµÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± -->
  <div class="popup-box" id="popup-parent">
   <h3>ğŸ“ ØªÙˆØ§ØµÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</h3><label><input type="radio" name="parent-choice" value="Ù„Ù… ÙŠØªÙ…"> Ù„Ù… ÙŠØªÙ…</label><br><label><input type="radio" name="parent-choice" value="ØªÙ… Ø§Ù„ÙŠÙˆÙ…"> ØªÙ… Ø§Ù„ÙŠÙˆÙ…</label><br><label><input type="radio" name="parent-choice" value="ØªÙ… Ù‚Ø±ÙŠØ¨Ù‹Ø§"> ØªÙ… Ù‚Ø±ÙŠØ¨Ù‹Ø§</label><br><label><input type="radio" name="parent-choice" value="Ù…ØªØ£Ø®Ø±"> Ù…ØªØ£Ø®Ø±</label><br><br><button id="save-parent">Ø­ÙØ¸</button> <button class="popup-close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div><!-- Ù†Ø§ÙØ°Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…Ø© -->
  <div class="popup-box" id="popup-teacher-login">
   <h3>ğŸ‘©â€ğŸ« Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</h3>
   <p style="text-align: center; margin-bottom: 20px; color: #666;">Ø£Ø¯Ø®Ù„ÙŠ Ø±Ù‚Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ (1ØŒ 2ØŒ 3ØŒ Ø£Ùˆ 4)</p><input type="text" id="teacher-code-input" placeholder="Ø£Ø¯Ø®Ù„ÙŠ Ø±Ù‚Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„" style="width: 100%; padding: 12px; text-align: center; font-size: 18px; margin-bottom: 20px; border: 2px solid #d1d5db; border-radius: 8px;">
   <div id="login-error" style="color: #ef4444; text-align: center; margin-bottom: 15px; display: none;">
    âŒ Ø±Ù‚Ù… Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­
   </div><button id="btn-teacher-login">Ø¯Ø®ÙˆÙ„</button> <button class="popup-close">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
  <script>
/* =========================================
   Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Data SDK
   ========================================= */

// Ø¥Ø­Ø¶Ø§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
const panelHome = document.getElementById("panel-home");
const panelTeacher = document.getElementById("panel-teacher");
const panelStudent = document.getElementById("panel-student");

const btnGoTeacher = document.getElementById("btn-go-teacher");
const btnGoStudent = document.getElementById("btn-go-student");
const btnBackHome = document.getElementById("btn-back-home");
const btnBackStudent = document.getElementById("btn-back-student");

// Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
function showPanel(panel) {
    panelHome.style.display = "none";
    panelTeacher.style.display = "none";
    panelStudent.style.display = "none";
    panel.style.display = "block";
    window.scrollTo(0, 0);
}

// Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©
btnGoTeacher.addEventListener("click", function () {
    document.getElementById("popup-teacher-login").style.display = "block";
    overlay.style.display = "block";
});

// Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨Ø©
btnGoStudent.addEventListener("click", function () {
    showPanel(panelStudent);
});

// Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
btnBackHome.addEventListener("click", function () {
    showPanel(panelHome);
});

btnBackStudent.addEventListener("click", function () {
    showPanel(panelHome);
});

/* =========================================
   Data SDK Implementation
   ========================================= */

let students = [];
const tableBody = document.getElementById("students-body");

const btnAddStudent = document.getElementById("btn-add-student");
const btnClearAll = document.getElementById("btn-clear-all");
const btnLoadDemo = document.getElementById("btn-load-demo");
const overlay = document.getElementById("popup-overlay");

// Data SDK Handler
const dataHandler = {
    onDataChanged(data) {
        students = data.map(record => ({
            __backendId: record.__backendId,
            id: record.id,
            name: record.name,
            class: record.class,
            exam: record.exam,
            activity: record.activity,
            homework: record.homework,
            discussion: record.discussion,
            coop: record.coop,
            strength: record.strength ? record.strength.split('|||') : [],
            excellence: record.excellence ? record.excellence.split('|||') : [],
            weakness: record.weakness ? record.weakness.split('|||') : [],
            total: record.total,
            plan: record.plan,
            status: record.status,
            attendance: record.attendance,
            parent: record.parent,
            familyCount: record.familyCount
        }));
        
        renderTable();
    }
};

// Initialize Data SDK
async function initDataSdk() {
    if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
            console.error("Failed to initialize Data SDK");
        }
    }
}

// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨Ø© Ø¥Ù„Ù‰ ØµÙŠØºØ© DataObject
function studentToDataObject(student) {
    return {
        id: student.id,
        name: student.name,
        class: student.class,
        exam: student.exam,
        activity: student.activity,
        homework: student.homework,
        discussion: student.discussion,
        coop: student.coop || "",
        strength: student.strength.join('|||'),
        excellence: student.excellence.join('|||'),
        weakness: student.weakness.join('|||'),
        total: student.total,
        plan: student.plan || "",
        status: student.status || "",
        attendance: student.attendance,
        parent: student.parent || "",
        familyCount: student.familyCount || 0
    };
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Toast
function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast-message';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// Ø²Ø± Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
btnClearAll.addEventListener("click", function () {
    const confirmBox = document.createElement('div');
    confirmBox.className = 'confirm-dialog';
    confirmBox.innerHTML = `
        <h3>âš ï¸ ØªØ­Ø°ÙŠØ±</h3>
        <p>Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.</p>
        <button class="confirm-yes">Ù†Ø¹Ù…ØŒ Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
        <button class="confirm-no">Ø¥Ù„ØºØ§Ø¡</button>
    `;
    document.body.appendChild(confirmBox);
    overlay.style.display = "block";
    
    confirmBox.querySelector('.confirm-yes').onclick = async function() {
        this.disabled = true;
        this.innerHTML = '<span class="loading-spinner"></span>';
        
        for (const student of students) {
            if (student.__backendId) {
                const dataObj = { ...studentToDataObject(student), __backendId: student.__backendId };
                await window.dataSdk.delete(dataObj);
            }
        }
        
        document.body.removeChild(confirmBox);
        overlay.style.display = "none";
        showToast("âœ” ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    };
    
    confirmBox.querySelector('.confirm-no').onclick = function() {
        document.body.removeChild(confirmBox);
        overlay.style.display = "none";
    };
});

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
btnLoadDemo.addEventListener("click", async function () {
    if (students.length >= 999) {
        showToast("âŒ ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (999)");
        return;
    }
    
    this.disabled = true;
    this.innerHTML = '<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
    
    const demoStudents = [
        { id: Date.now(), name: "Ø³Ø§Ø±Ø© Ù…Ø­Ù…Ø¯ Ø§Ù„ØºØ±Ø¨ÙŠ", class: "Ø«Ø§Ù„Ø« 1", exam: 25, activity: 26, homework: 18, discussion: 19, coop: "Ù…Ù…ØªØ§Ø²Ø©", strength: ["ØªÙØ§Ø¹Ù„ Ù…Ù…ØªØ§Ø²"], excellence: ["Ø£Ø¯Ø§Ø¡ Ù…ØªÙ…ÙŠØ²"], weakness: [], total: 0, plan: "", status: "", attendance: 0, parent: "", familyCount: 0 },
        { id: Date.now() + 1, name: "Ø¬ÙˆØ¯ Ø®Ø§Ù„Ø¯ Ø§Ù„Ù‚Ø·ÙŠØ±ÙŠ", class: "Ø«Ø§Ù„Ø« 2", exam: 22, activity: 27, homework: 17, discussion: 18, coop: "Ø¬ÙŠØ¯Ø©", strength: ["Ù†Ø´ÙŠØ·Ø©"], excellence: [], weakness: ["Ø¨Ø­Ø§Ø¬Ø© Ù„ØªØ­Ø³ÙŠÙ†"], total: 0, plan: "", status: "", attendance: 1, parent: "", familyCount: 0 }
    ];
    
    for (const student of demoStudents) {
        calculateTotal(student);
        const result = await window.dataSdk.create(studentToDataObject(student));
        if (!result.isOk) {
            showToast("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        }
    }
    
    this.disabled = false;
    this.innerHTML = 'ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©';
    showToast("âœ” ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©");
});

// Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
btnAddStudent.addEventListener("click", function () {
    if (students.length >= 999) {
        showToast("âŒ ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (999 Ø·Ø§Ù„Ø¨Ø©)");
        return;
    }
    
    const confirmBox = document.createElement('div');
    confirmBox.className = 'confirm-dialog';
    confirmBox.innerHTML = `
        <h3>â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <input type="text" id="new-student-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" style="width: 100%; padding: 10px; margin: 10px 0; border: 2px solid #d1d5db; border-radius: 8px; font-size: 15px;">
        <input type="text" id="new-student-class" placeholder="Ø§Ù„ÙØµÙ„ (Ù…Ø«Ø§Ù„: Ø«Ø§Ù„Ø« 1)" style="width: 100%; padding: 10px; margin: 10px 0; border: 2px solid #d1d5db; border-radius: 8px; font-size: 15px;">
        <button class="confirm-yes" style="background: #10b981;">Ø¥Ø¶Ø§ÙØ©</button>
        <button class="confirm-no">Ø¥Ù„ØºØ§Ø¡</button>
    `;
    document.body.appendChild(confirmBox);
    overlay.style.display = "block";
    
    confirmBox.querySelector('.confirm-yes').onclick = async function() {
        const name = document.getElementById("new-student-name").value.trim();
        const cls = document.getElementById("new-student-class").value.trim();
        
        if (!name || !cls) {
            showToast("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙØµÙ„");
            return;
        }
        
        this.disabled = true;
        this.innerHTML = '<span class="loading-spinner"></span>';
        
        const newStudent = {
            id: Date.now(),
            name: name,
            class: cls,
            exam: 0,
            activity: 0,
            homework: 0,
            discussion: 0,
            coop: "",
            strength: [],
            excellence: [],
            weakness: [],
            total: 0,
            plan: "",
            status: "",
            attendance: 0,
            parent: "",
            familyCount: 0
        };
        
        calculateTotal(newStudent);
        
        const result = await window.dataSdk.create(studentToDataObject(newStudent));
        
        if (result.isOk) {
            showToast("âœ” ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­");
        } else {
            showToast("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
        }
        
        document.body.removeChild(confirmBox);
        overlay.style.display = "none";
    };
    
    confirmBox.querySelector('.confirm-no').onclick = function() {
        document.body.removeChild(confirmBox);
        overlay.style.display = "none";
    };
});

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ ÙˆØ§Ù„Ø­Ø§Ù„Ø©
function calculateTotal(s) {
    s.total = Number(s.exam) + Number(s.activity) + Number(s.homework) + Number(s.discussion);
    
    if (s.total >= 95) s.status = "Ù…ØªÙÙˆÙ‚Ø©";
    else if (s.total >= 85) s.status = "Ø¬ÙŠØ¯Ø© Ø¬Ø¯Ù‹Ø§";
    else if (s.total >= 75) s.status = "Ø¬ÙŠØ¯Ø©";
    else if (s.total >= 60) s.status = "Ù…ØªÙˆØ³Ø·Ø©";
    else s.status = "ØªØ­ØªØ§Ø¬ Ø¯Ø¹Ù…";
}

/* =========================================
   Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
   ========================================= */

function renderTable() {
    tableBody.innerHTML = "";
    
    students.forEach((s, index) => {
        const row = document.createElement("tr");
        
        row.innerHTML = `
            <td>${index + 1}</td>
            <td>${s.name}</td>
            <td>${s.class}</td>
            <td><input type="number" class="score-input" value="${s.exam}" data-id="${s.__backendId}" data-field="exam" min="0" max="30"></td>
            <td><input type="number" class="score-input" value="${s.activity}" data-id="${s.__backendId}" data-field="activity" min="0" max="30"></td>
            <td><input type="number" class="score-input" value="${s.homework}" data-id="${s.__backendId}" data-field="homework" min="0" max="20"></td>
            <td><input type="number" class="score-input" value="${s.discussion}" data-id="${s.__backendId}" data-field="discussion" min="0" max="20"></td>
            <td><button class="btn-table btn-coop" data-id="${s.__backendId}">ğŸ¤ ${s.coop || ''}</button></td>
            <td><button class="btn-table btn-strength" data-id="${s.__backendId}">ğŸ’ª (${s.strength.length})</button></td>
            <td><button class="btn-table btn-excellence" data-id="${s.__backendId}">âœ¨ (${s.excellence.length})</button></td>
            <td><button class="btn-table btn-weakness" data-id="${s.__backendId}">âš  (${s.weakness.length})</button></td>
            <td class="total-score">${s.total}</td>
            <td><button class="btn-plan" data-id="${s.__backendId}">ğŸ“</button></td>
            <td><button class="btn-analysis" data-id="${s.__backendId}">ğŸ” ${s.status}</button></td>
            <td><button class="btn-parent" data-id="${s.__backendId}">ğŸ“ ${s.parent || ''}</button></td>
            <td><input type="number" class="score-input attendance-input" value="${s.attendance}" data-id="${s.__backendId}" data-field="attendance" min="0"></td>
        `;
        
        tableBody.appendChild(row);
    });
    
    attachEvents();
    updateStats();
}

async function updateStudent(backendId, updates) {
    const student = students.find(s => s.__backendId === backendId);
    if (!student) return;
    
    Object.assign(student, updates);
    calculateTotal(student);
    
    const dataObj = { ...studentToDataObject(student), __backendId: student.__backendId };
    const result = await window.dataSdk.update(dataObj);
    
    if (!result.isOk) {
        showToast("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«");
    }
}

function attachEvents() {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
    document.querySelectorAll(".score-input").forEach(input => {
        input.addEventListener("change", async function () {
            const backendId = this.dataset.id;
            const field = this.dataset.field;
            const value = Number(this.value);
            
            await updateStudent(backendId, { [field]: value });
        });
    });
    
    // Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©
    document.querySelectorAll(".btn-strength").forEach(btn => {
        btn.addEventListener("click", function () {
            openPopup("strength", this.dataset.id);
        });
    });
    
    // Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ…ÙŠØ²
    document.querySelectorAll(".btn-excellence").forEach(btn => {
        btn.addEventListener("click", function () {
            openPopup("excellence", this.dataset.id);
        });
    });
    
    // Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù
    document.querySelectorAll(".btn-weakness").forEach(btn => {
        btn.addEventListener("click", function () {
            openPopup("weakness", this.dataset.id);
        });
    });
    
    // Ø§Ù„ØªØ¹Ø§ÙˆÙ†
    document.querySelectorAll(".btn-coop").forEach(btn => {
        btn.addEventListener("click", function () {
            openPopup("coop", this.dataset.id);
        });
    });
    
    // Ø®Ø·Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
    document.querySelectorAll(".btn-plan").forEach(btn => {
        btn.addEventListener("click", function () {
            openPopup("plan", this.dataset.id);
        });
    });
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©
    document.querySelectorAll(".btn-analysis").forEach(btn => {
        btn.addEventListener("click", function () {
            openPopup("analysis", this.dataset.id);
        });
    });
    
    // ØªÙˆØ§ØµÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
    document.querySelectorAll(".btn-parent").forEach(btn => {
        btn.addEventListener("click", function () {
            openPopup("parent", this.dataset.id);
        });
    });
}

/* =========================================
   ÙÙ„ØªØ± Ø§Ù„ÙØµÙˆÙ„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
   ========================================= */

const classSelect = document.getElementById("class-select");

classSelect.addEventListener("change", function () {
    const selected = this.value;
    
    if (!selected) {
        renderTable();
        return;
    }
    
    const filtered = students.filter(s => s.class === selected);
    renderFilteredTable(filtered);
    updateFilteredStats(filtered);
});

function renderFilteredTable(list) {
    tableBody.innerHTML = "";
    
    list.forEach((s, index) => {
        const row = document.createElement("tr");
        
        row.innerHTML = `
            <td>${index + 1}</td>
            <td>${s.name}</td>
            <td>${s.class}</td>
            <td>${s.exam}</td>
            <td>${s.activity}</td>
            <td>${s.homework}</td>
            <td>${s.discussion}</td>
            <td>${s.coop}</td>
            <td>${s.strength.join("<br>") || "â€”"}</td>
            <td>${s.excellence.join("<br>") || "â€”"}</td>
            <td>${s.weakness.join("<br>") || "â€”"}</td>
            <td class="total-score">${s.total}</td>
            <td>${s.plan ? "âœ“" : "â€”"}</td>
            <td>${s.status}</td>
            <td>${s.parent || "â€”"}</td>
            <td>${s.attendance}</td>
        `;
        
        tableBody.appendChild(row);
    });
}

document.getElementById("btn-stat-reset").addEventListener("click", function () {
    classSelect.value = "";
    renderTable();
});

function updateStats() {
    if (students.length === 0) {
        document.getElementById("stat-total").textContent = "0";
        document.getElementById("stat-average").textContent = "0";
        document.getElementById("stat-attendance").textContent = "0%";
        document.getElementById("stat-late").textContent = "0";
        document.getElementById("stat-soon").textContent = "0";
        document.getElementById("stat-today").textContent = "0";
        return;
    }
    
    document.getElementById("stat-total").textContent = students.length;
    
    const avg = students.reduce((a, b) => a + b.total, 0) / students.length;
    document.getElementById("stat-average").textContent = avg.toFixed(1);
    
    const attendanceAvg = students.reduce((a, b) => a + (b.attendance || 0), 0);
    const attendancePercent = 100 - (attendanceAvg / students.length) * 10;
    document.getElementById("stat-attendance").textContent = Math.max(0, attendancePercent).toFixed(1) + "%";
    
    document.getElementById("stat-late").textContent = students.filter(s => s.plan && s.plan.includes("Ù…ØªØ£Ø®Ø±Ø©")).length;
    document.getElementById("stat-soon").textContent = students.filter(s => s.plan && s.plan.includes("Ù‚Ø±ÙŠØ¨")).length;
    document.getElementById("stat-today").textContent = students.filter(s => s.plan && s.plan.includes("Ø§Ù„ÙŠÙˆÙ…")).length;
}

function updateFilteredStats(list) {
    if (list.length === 0) return;
    
    document.getElementById("stat-total").textContent = list.length;
    
    const avg = list.reduce((a, b) => a + b.total, 0) / list.length;
    document.getElementById("stat-average").textContent = avg.toFixed(1);
    
    const attendanceAvg = list.reduce((a, b) => a + (b.attendance || 0), 0);
    const attendancePercent = 100 - (attendanceAvg / list.length) * 10;
    document.getElementById("stat-attendance").textContent = Math.max(0, attendancePercent).toFixed(1) + "%";
}

/* =========================================
   Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
   ========================================= */

let currentBackendId = null;

function openPopup(type, backendId) {
    currentBackendId = backendId;
    overlay.style.display = "block";
    hideAllPopups();
    
    if (type === "strength") {
        document.getElementById("popup-strength").style.display = "block";
        document.getElementById("strength-input").value = "";
    }
    if (type === "excellence") {
        document.getElementById("popup-excellence").style.display = "block";
        document.getElementById("excellence-input").value = "";
    }
    if (type === "weakness") {
        document.getElementById("popup-weakness").style.display = "block";
        document.getElementById("weakness-input").value = "";
    }
    if (type === "coop") {
        document.getElementById("popup-coop").style.display = "block";
    }
    if (type === "plan") {
        const student = students.find(s => s.__backendId === currentBackendId);
        document.getElementById("popup-plan").style.display = "block";
        document.getElementById("plan-input").value = student ? student.plan : "";
    }
    if (type === "analysis") {
        showAnalysisPopup();
    }
    if (type === "parent") {
        document.getElementById("popup-parent").style.display = "block";
    }
}

function hideAllPopups() {
    document.querySelectorAll(".popup-box").forEach(p => {
        p.style.display = "none";
    });
}

function closePopup() {
    hideAllPopups();
    overlay.style.display = "none";
}

overlay.addEventListener("click", closePopup);

document.querySelectorAll(".popup-close").forEach(btn => {
    btn.addEventListener("click", closePopup);
});

// Ø­ÙØ¸ Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©
document.getElementById("save-strength").addEventListener("click", async function () {
    const txt = document.getElementById("strength-input").value.trim();
    const student = students.find(s => s.__backendId === currentBackendId);
    
    if (txt && student) {
        this.disabled = true;
        this.innerHTML = '<span class="loading-spinner"></span>';
        
        student.strength.push(txt);
        await updateStudent(currentBackendId, { strength: student.strength });
        
        closePopup();
        showToast("âœ” ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­");
        this.disabled = false;
        this.textContent = "Ø­ÙØ¸";
    }
});

// Ø­ÙØ¸ Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ…ÙŠØ²
document.getElementById("save-excellence").addEventListener("click", async function () {
    const txt = document.getElementById("excellence-input").value.trim();
    const student = students.find(s => s.__backendId === currentBackendId);
    
    if (txt && student) {
        this.disabled = true;
        this.innerHTML = '<span class="loading-spinner"></span>';
        
        student.excellence.push(txt);
        await updateStudent(currentBackendId, { excellence: student.excellence });
        
        closePopup();
        showToast("âœ” ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­");
        this.disabled = false;
        this.textContent = "Ø­ÙØ¸";
    }
});

// Ø­ÙØ¸ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù
document.getElementById("save-weakness").addEventListener("click", async function () {
    const txt = document.getElementById("weakness-input").value.trim();
    const student = students.find(s => s.__backendId === currentBackendId);
    
    if (txt && student) {
        this.disabled = true;
        this.innerHTML = '<span class="loading-spinner"></span>';
        
        student.weakness.push(txt);
        await updateStudent(currentBackendId, { weakness: student.weakness });
        
        closePopup();
        showToast("âœ” ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­");
        this.disabled = false;
        this.textContent = "Ø­ÙØ¸";
    }
});

// Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø§ÙˆÙ†
document.querySelectorAll(".coop-option").forEach(btn => {
    btn.addEventListener("click", async function () {
        this.disabled = true;
        
        await updateStudent(currentBackendId, { coop: this.dataset.value });
        
        closePopup();
        showToast("âœ” ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");
        this.disabled = false;
    });
});

// Ø­ÙØ¸ Ø®Ø·Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
document.getElementById("save-plan").addEventListener("click", async function () {
    const txt = document.getElementById("plan-input").value.trim();
    
    this.disabled = true;
    this.innerHTML = '<span class="loading-spinner"></span>';
    
    await updateStudent(currentBackendId, { plan: txt });
    
    closePopup();
    showToast("âœ” ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­");
    this.disabled = false;
    this.textContent = "Ø­ÙØ¸";
});

// ØªÙˆÙ„ÙŠØ¯ Ø®Ø·Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
document.getElementById("ai-plan").addEventListener("click", function () {
    const s = students.find(s => s.__backendId === currentBackendId);
    
    if (!s) return;
    
    let aiText = `Ø®Ø·Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù„Ù„Ø·Ø§Ù„Ø¨Ø© ${s.name}:\n\n`;
    
    if (s.total < 60) {
        aiText += "ğŸ”´ ØªØ±ÙƒÙŠØ² Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù„Ù‰ Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§ØªØŒ ÙˆØ§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©.\n";
    } else if (s.total < 75) {
        aiText += "ğŸŸ¡ ØªØ¹Ø²ÙŠØ² Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ©.\n";
    } else {
        aiText += "ğŸŸ¢ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¨Ø³ÙŠØ·Ø©.\n";
    }
    
    aiText += "\nÙ†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©:\n";
    aiText += (s.strength.length ? s.strength.map(i => "â€¢ " + i).join("\n") : "â€¢ Ù„Ø§ ÙŠÙˆØ¬Ø¯");
    
    aiText += "\n\nÙ†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù:\n";
    aiText += (s.weakness.length ? s.weakness.map(i => "â€¢ " + i).join("\n") : "â€¢ Ù„Ø§ ÙŠÙˆØ¬Ø¯");
    
    document.getElementById("plan-input").value = aiText;
});

// ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø©
function showAnalysisPopup() {
    const student = students.find(s => s.__backendId === currentBackendId);
    
    if (!student) return;
    
    const txt = `ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø©:

Ø§Ù„Ø§Ø³Ù…: ${student.name}
Ø§Ù„ÙØµÙ„: ${student.class}
Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${student.total} Ù…Ù† 100
Ø§Ù„Ø­Ø§Ù„Ø©: ${student.status}

Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©:
${student.strength.length ? student.strength.map(i => "â€¢ " + i).join("\n") : "â€¢ Ù„Ø§ ÙŠÙˆØ¬Ø¯"}

Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ…ÙŠØ²:
${student.excellence.length ? student.excellence.map(i => "â€¢ " + i).join("\n") : "â€¢ Ù„Ø§ ÙŠÙˆØ¬Ø¯"}

Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù:
${student.weakness.length ? student.weakness.map(i => "â€¢ " + i).join("\n") : "â€¢ Ù„Ø§ ÙŠÙˆØ¬Ø¯"}

Ø§Ù„ØªØ¹Ø§ÙˆÙ†: ${student.coop || "â€”"}
Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨: ${student.attendance}
`;
    
    document.getElementById("analysis-text").textContent = txt;
    document.getElementById("popup-analysis").style.display = "block";
}

// Ø­ÙØ¸ ØªÙˆØ§ØµÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
document.getElementById("save-parent").addEventListener("click", async function () {
    const choice = document.querySelector("input[name='parent-choice']:checked");
    
    if (choice) {
        this.disabled = true;
        this.innerHTML = '<span class="loading-spinner"></span>';
        
        await updateStudent(currentBackendId, { parent: choice.value });
        
        closePopup();
        showToast("âœ” ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");
        this.disabled = false;
        this.textContent = "Ø­ÙØ¸";
    }
});

/* =========================================
   ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø©
   ========================================= */

const btnSearchStudent = document.getElementById("btn-search-student");
const stNameInput = document.getElementById("student-name-input");

btnSearchStudent.addEventListener("click", function () {
    const name = stNameInput.value.trim();
    
    if (!name) {
        showToast("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…");
        return;
    }
    
    const student = students.find(s => s.name.includes(name));
    
    if (!student) {
        showToast("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨Ø©");
        return;
    }
    
    showStudentPanel(student);
});

stNameInput.addEventListener("keypress", function (e) {
    if (e.key === "Enter") {
        btnSearchStudent.click();
    }
});

async function showStudentPanel(student) {
    document.getElementById("st-name").textContent = student.name;
    document.getElementById("st-class").textContent = student.class;
    document.getElementById("st-total").textContent = student.total;
    document.getElementById("st-status").textContent = student.status;
    
    document.getElementById("st-exam").textContent = student.exam;
    document.getElementById("st-activity").textContent = student.activity;
    document.getElementById("st-homework").textContent = student.homework;
    document.getElementById("st-discussion").textContent = student.discussion;
    document.getElementById("st-attendance").textContent = student.attendance;
    
    const stStrengthList = document.getElementById("st-strength");
    const stExcellenceList = document.getElementById("st-excellence");
    const stWeaknessList = document.getElementById("st-weakness");
    
    stStrengthList.innerHTML = student.strength.length ? student.strength.map(i => "<li>" + i + "</li>").join("") : "<li>Ù„Ø§ ÙŠÙˆØ¬Ø¯</li>";
    stExcellenceList.innerHTML = student.excellence.length ? student.excellence.map(i => "<li>" + i + "</li>").join("") : "<li>Ù„Ø§ ÙŠÙˆØ¬Ø¯</li>";
    stWeaknessList.innerHTML = student.weakness.length ? student.weakness.map(i => "<li>" + i + "</li>").join("") : "<li>Ù„Ø§ ÙŠÙˆØ¬Ø¯</li>";
    
    document.getElementById("st-plan").textContent = student.plan || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø© Ù…Ø³Ø¬Ù„Ø©";
    
    const recommend = 
        student.total >= 90 ? "ğŸŒŸ Ù†Ù†ØµØ­ Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª ØªÙ‚Ù†ÙŠØ©" :
        student.total >= 80 ? "ğŸ’¡ ÙŠÙ…ÙƒÙ† Ù„Ù„Ø·Ø§Ù„Ø¨Ø© ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§ØªÙ‡Ø§ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©" :
        student.total >= 70 ? "ğŸ“˜ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" :
        "ğŸ”´ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…ØªØ§Ø¨Ø¹Ø© Ù…ÙƒØ«ÙØ© ÙˆØ®Ø·Ø© Ø¯Ø¹Ù…";
    
    document.getElementById("st-recommend").textContent = recommend;
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø³Ø±Ø©
    await updateStudent(student.__backendId, { familyCount: (student.familyCount || 0) + 1 });
    
    // ==== Ø²Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ====
    const contactBtn = document.getElementById("btn-contact-teacher");
    
    if (contactBtn) {
        // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
        const newContactBtn = contactBtn.cloneNode(true);
        contactBtn.parentNode.replaceChild(newContactBtn, contactBtn);
        
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨Ø©
        const studentName = student.name;
        const studentClass = student.class;
        const studentTotal = student.total;
        const studentStatus = student.status;
        
        newContactBtn.addEventListener("click", function() {
            // Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…Ø®ØµØµØ© Ø¨Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡Ø§
            const defaultMessage = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ Ø£Ø³ØªØ§Ø°Ø© Ø´Ø°Ø§ ğŸŒ¸

Ø£Ù†Ø§ ÙˆÙ„ÙŠ Ø£Ù…Ø± Ø§Ù„Ø·Ø§Ù„Ø¨Ø©: *${studentName}*
Ø§Ù„ÙØµÙ„: ${studentClass}

Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù…Ø³ØªÙˆÙ‰ Ø§Ø¨Ù†ØªÙŠ ÙÙŠ Ù…Ø§Ø¯Ø© ØªÙ‚Ù†ÙŠØ© Ø±Ù‚Ù…ÙŠØ©.

ğŸ“Š Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${studentTotal} Ù…Ù† 100
ğŸ“ˆ Ø§Ù„Ø­Ø§Ù„Ø©: ${studentStatus}

Ø£Ø±ØºØ¨ ÙÙŠ Ù…Ø¹Ø±ÙØ©:
â€¢ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ø¨Ù†ØªÙŠ Ù„ØªØ­Ø³ÙŠÙ† Ù…Ø³ØªÙˆØ§Ù‡Ø§ØŸ
â€¢ Ù…Ø§ Ù‡ÙŠ Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„ÙŠÙ‡Ø§ØŸ
â€¢ Ù‡Ù„ Ù‡Ù†Ø§Ùƒ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¯Ø¹Ù… Ø¥Ø¶Ø§ÙÙŠØŸ

Ø´Ø§ÙƒØ±ÙŠÙ† Ù„ÙƒÙ… Ø¬Ù‡ÙˆØ¯ÙƒÙ… Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø© ğŸ™`;

            const encodedMessage = encodeURIComponent(defaultMessage);
            const whatsappNumber = "966555320501";
            const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
            
            // ÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
            const link = document.createElement('a');
            link.href = whatsappURL;
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    }
}

/* =========================================
   Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©
   ========================================= */

document.getElementById("btn-teacher-login").addEventListener("click", function () {
    const code = document.getElementById("teacher-code-input").value.trim();
    const errorDiv = document.getElementById("login-error");
    
    if (code === "1" || code === "2" || code === "3" || code === "4") {
        hideAllPopups();
        overlay.style.display = "none";
        showPanel(panelTeacher);
        document.getElementById("teacher-code-input").value = "";
        errorDiv.style.display = "none";
    } else {
        errorDiv.style.display = "block";
    }
});

document.getElementById("teacher-code-input").addEventListener("keypress", function (e) {
    if (e.key === "Enter") {
        document.getElementById("btn-teacher-login").click();
    }
});

/* =========================================
   ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
   ========================================= */

initDataSdk();
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9abb255eb7c3ce00',t:'MTc2NTM1Mjk3MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
