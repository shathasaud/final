<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      width: 100%;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      overflow-x: hidden;
    }

    .app-wrapper {
      width: 100%;
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      padding: 2%;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .header h1 {
      font-size: clamp(1.2em, 4vw, 2em);
      color: #667eea;
      margin-bottom: 1%;
    }

    .student-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2%;
      margin-top: 2%;
    }

    .student-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8em;
    }

    .student-name {
      font-size: 1.3em;
      font-weight: bold;
      color: #333;
    }

    .navigation {
      background: rgba(255, 255, 255, 0.95);
      display: flex;
      justify-content: space-around;
      padding: 1.5% 2%;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      flex-wrap: wrap;
      gap: 1%;
    }

    .nav-item {
      padding: 1.5% 3%;
      cursor: pointer;
      border-radius: 10px;
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: clamp(0.85em, 2vw, 1em);
      white-space: nowrap;
    }

    .nav-item:hover {
      background: rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }

    .nav-item.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    main {
      flex: 1;
      padding: 2% 3%;
      overflow-y: auto;
    }

    .page {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .overview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2%;
      margin-bottom: 3%;
    }

    .overview-card {
      background: white;
      border-radius: 15px;
      padding: 3%;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .overview-card h3 {
      font-size: 1.1em;
      margin-bottom: 3%;
      color: #333;
    }

    .overview-stat-value {
      font-size: 2.5em;
      font-weight: bold;
      color: #667eea;
      margin: 2% 0;
    }

    .overview-stat-label {
      font-size: 0.9em;
      color: #666;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 3%;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 3%;
    }

    .card h2 {
      font-size: 1.5em;
      margin-bottom: 3%;
      color: #333;
      border-bottom: 3px solid #667eea;
      padding-bottom: 2%;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2%;
      margin-bottom: 3%;
    }

    .stat-item {
      background: #f8f9ff;
      padding: 3%;
      border-radius: 12px;
      text-align: center;
    }

    .stat-label {
      font-size: 0.95em;
      color: #666;
      margin-bottom: 2%;
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #667eea;
    }

    .progress-circle-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 4% 0;
      position: relative;
    }

    .progress-circle {
      transform: rotate(-90deg);
    }

    .progress-text {
      position: absolute;
      font-size: 2.5em;
      font-weight: bold;
      color: #667eea;
    }

    .achievement-list {
      display: flex;
      flex-direction: column;
      gap: 2%;
    }

    .achievement-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2.5%;
      background: #f8f9ff;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .achievement-item:hover {
      transform: translateX(-5px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .achievement-info h4 {
      font-size: 1.1em;
      margin-bottom: 1%;
      color: #333;
    }

    .achievement-info p {
      font-size: 0.9em;
      color: #666;
    }

    .achievement-score {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2% 4%;
      border-radius: 50px;
      font-size: 1.3em;
      font-weight: bold;
      min-width: 60px;
      text-align: center;
      margin-right: 2%;
    }

    .prediction-bar {
      background: #e0e0e0;
      height: 40px;
      border-radius: 20px;
      overflow: hidden;
      margin: 3% 0;
      position: relative;
    }

    .prediction-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .trend-indicator {
      display: inline-block;
      padding: 1.5% 3%;
      border-radius: 20px;
      font-weight: bold;
      margin: 2% 0;
      background: #e0e0e0;
    }

    .trend-indicator.trend-up {
      background: #d4edda;
      color: #155724;
    }

    .trend-indicator.trend-down {
      background: #f8d7da;
      color: #721c24;
    }

    .form-group {
      margin-bottom: 3%;
    }

    .form-group label {
      display: block;
      margin-bottom: 2%;
      font-weight: 600;
      color: #333;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 2.5%;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1em;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2.5% 5%;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2%;
      position: relative;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-delete {
      background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
      padding: 1.5% 3%;
      width: auto;
      margin-left: 2%;
    }

    .loading-spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 5%;
      color: #999;
    }

    .empty-state-icon {
      font-size: 4em;
      margin-bottom: 2%;
    }

    .add-achievement-form {
      background: #f8f9ff;
      padding: 3%;
      border-radius: 15px;
    }

    .score-cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 2%;
      margin-top: 3%;
    }

    .score-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 3%;
      border-radius: 12px;
      text-align: center;
    }

    .score-card-title {
      font-size: 0.85em;
      margin-bottom: 2%;
      opacity: 0.9;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .score-card-value {
      font-size: 2em;
      font-weight: bold;
      margin: 2% 0;
    }

    .score-card-date {
      font-size: 0.8em;
      opacity: 0.8;
    }

    .message-templates {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2%;
      margin-bottom: 3%;
    }

    .template-btn {
      padding: 2%;
      border: 2px solid #667eea;
      background: white;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      font-weight: 600;
      color: #667eea;
    }

    .template-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }

    .share-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2%;
      margin-top: 3%;
    }

    .message-tabs {
      display: flex;
      gap: 2%;
      margin-bottom: 3%;
      flex-wrap: wrap;
    }

    .msg-tab {
      padding: 2% 4%;
      border-radius: 10px;
      cursor: pointer;
      background: #f0f0f0;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .msg-tab:hover {
      background: #e0e0e0;
    }

    .msg-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .message-item {
      background: #f8f9ff;
      padding: 3%;
      border-radius: 12px;
      margin-bottom: 2%;
      border-right: 4px solid #667eea;
    }

    .message-item.unread {
      background: #fff8e1;
      border-right-color: #ffa726;
    }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2%;
      flex-wrap: wrap;
      gap: 2%;
    }

    .message-category-badge {
      padding: 1% 2%;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
    }

    .message-category-badge.inquiry {
      background: #e3f2fd;
      color: #1976d2;
    }

    .message-category-badge.behavior {
      background: #fff3e0;
      color: #f57c00;
    }

    .message-category-badge.academic {
      background: #f3e5f5;
      color: #7b1fa2;
    }

    .message-category-badge.appreciation {
      background: #e8f5e9;
      color: #388e3c;
    }

    .message-sender {
      font-size: 0.9em;
      color: #666;
    }

    .message-text {
      margin: 2% 0;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .message-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2%;
      font-size: 0.85em;
      color: #999;
      flex-wrap: wrap;
      gap: 2%;
    }

    .delete-message-btn {
      background: #f5576c;
      color: white;
      border: none;
      padding: 1.5% 3%;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9em;
    }

    .delete-message-btn:hover {
      background: #e04657;
    }

    @media (max-width: 768px) {
      .navigation {
        padding: 2% 1%;
      }

      .nav-item {
        padding: 2% 3%;
        font-size: 0.85em;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .overview-grid {
        grid-template-columns: 1fr;
      }

      .share-buttons {
        grid-template-columns: 1fr;
      }

      .message-templates {
        grid-template-columns: 1fr;
      }

      .achievement-item {
        flex-direction: column;
        gap: 2%;
        text-align: center;
      }

      .achievement-score {
        margin-right: 0;
        margin-top: 2%;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-wrapper">
   <header class="header">
    <h1 id="dashboardTitle">Ø§Ù„Ù…Ù†ØµÙ‘Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©: ØªØ­Ù„ÙŠÙ„ â€“ ØªØ´Ø®ÙŠØµ â€“ ØªÙˆØ§ØµÙ„</h1>
    <div class="student-info">
     <div class="student-avatar">
      ğŸ‘¨â€ğŸ“
     </div>
     <div class="student-name" id="studentName">
      Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨
     </div>
    </div>
   </header>
   <nav class="navigation">
    <div class="nav-item active" onclick="navigateToPage('overview')">
     ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
    </div>
    <div class="nav-item" id="navAnalysis" onclick="navigateToPage('analysis')">
     Ù…Ø­ÙˆØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„
    </div>
    <div class="nav-item" id="navDiagnosis" onclick="navigateToPage('diagnosis')">
     Ù…Ø­ÙˆØ± Ø§Ù„ØªØ´Ø®ÙŠØµ
    </div>
    <div class="nav-item" id="navCommunication" onclick="navigateToPage('communication')">
     Ù…Ø­ÙˆØ± Ø§Ù„ØªÙˆØ§ØµÙ„
    </div>
    <div class="nav-item" onclick="navigateToPage('add')">
     â• Ø¥Ø¶Ø§ÙØ© Ø¥Ù†Ø¬Ø§Ø²
    </div>
   </nav>
   <main><!-- ØµÙØ­Ø© Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© -->
    <div id="overviewPage" class="page active">
     <div class="overview-grid">
      <div class="overview-card">
       <h3 id="overviewAnalysisTitle">ğŸ“Š Ù…Ø­ÙˆØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„</h3>
       <div class="overview-stat-value" id="overviewAcademicScore">
        0%
       </div>
       <div class="overview-stat-label">
        Ø§Ù„Ù…Ø¹Ø¯Ù„ â€¢ <span id="overviewAcademicCount">0</span> Ø¥Ù†Ø¬Ø§Ø²
       </div>
      </div>
      <div class="overview-card">
       <h3 id="overviewDiagnosisTitle">ğŸ’¬ Ù…Ø­ÙˆØ± Ø§Ù„ØªØ´Ø®ÙŠØµ</h3>
       <div class="overview-stat-value" id="overviewBehaviorScore">
        0%
       </div>
       <div class="overview-stat-label">
        Ø§Ù„Ù…Ø¹Ø¯Ù„ â€¢ <span id="overviewBehaviorCount">0</span> Ø¥Ù†Ø¬Ø§Ø²
       </div>
      </div>
      <div class="overview-card">
       <h3 id="overviewCommunicationTitle">ğŸ”„ Ù…Ø­ÙˆØ± Ø§Ù„ØªÙˆØ§ØµÙ„</h3>
       <div class="overview-stat-value" id="overviewPrediction">
        0%
       </div>
       <div class="overview-stat-label">
        Ø§Ù„ØªÙˆÙ‚Ø¹ â€¢ <span id="overviewTotal">0</span> Ø³Ø¬Ù„
       </div>
      </div>
     </div>
     <div class="card">
      <h2>ğŸ“ Ø¢Ø®Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h2>
      <div class="achievement-list" id="recentAchievements">
       <div class="empty-state">
        <div class="empty-state-icon">
         ğŸ“
        </div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>
       </div>
      </div>
     </div>
    </div><!-- ØµÙØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ -->
    <div id="analysisPage" class="page">
     <div class="card">
      <h2 id="academicLabel">ğŸ“Š Ù…Ø­ÙˆØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„</h2>
      <div class="stats-grid">
       <div class="stat-item">
        <div class="stat-label">
         Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        </div>
        <div class="stat-value" id="testsCount">
         0
        </div>
       </div>
       <div class="stat-item">
        <div class="stat-label">
         Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        </div>
        <div class="stat-value" id="testsAvg">
         0
        </div>
       </div>
       <div class="stat-item">
        <div class="stat-label">
         Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù…
        </div>
        <div class="stat-value" id="tasksCount">
         0
        </div>
       </div>
       <div class="stat-item">
        <div class="stat-label">
         Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ù‡Ø§Ù…
        </div>
        <div class="stat-value" id="tasksAvg">
         0
        </div>
       </div>
      </div>
      <div class="progress-circle-container">
       <svg width="200" height="200"><circle cx="100" cy="100" r="80" fill="none" stroke="#e0e0e0" stroke-width="20" /> <circle id="academicProgress" class="progress-circle" cx="100" cy="100" r="80" fill="none" stroke="#667eea" stroke-width="20" stroke-dasharray="502" stroke-dashoffset="502" stroke-linecap="round" />
       </svg>
       <div class="progress-text" id="academicScore">
        0%
       </div>
      </div>
      <h3 style="margin-top: 3%; margin-bottom: 2%;">ğŸ“ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h3>
      <div class="score-cards-grid" id="testScoresList">
       <div class="empty-state">
        <div class="empty-state-icon">
         ğŸ“
        </div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>
       </div>
      </div>
      <h3 style="margin-top: 3%; margin-bottom: 2%;">ğŸ“š Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</h3>
      <div class="achievement-list" id="academicList">
       <div class="empty-state">
        <div class="empty-state-icon">
         ğŸ“š
        </div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø¨Ø¹Ø¯</p>
       </div>
      </div>
     </div>
    </div><!-- ØµÙØ­Ø© Ø§Ù„ØªØ´Ø®ÙŠØµ -->
    <div id="diagnosisPage" class="page">
     <div class="card">
      <h2 id="behaviorLabel">ğŸ’¬ Ù…Ø­ÙˆØ± Ø§Ù„ØªØ´Ø®ÙŠØµ</h2>
      <div class="stats-grid">
       <div class="stat-item">
        <div class="stat-label">
         Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
        </div>
        <div class="stat-value" id="behaviorCount">
         0
        </div>
       </div>
       <div class="stat-item">
        <div class="stat-label">
         Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…
        </div>
        <div class="stat-value" id="behaviorAvg">
         0
        </div>
       </div>
      </div>
      <div class="progress-circle-container">
       <svg width="200" height="200"><circle cx="100" cy="100" r="80" fill="none" stroke="#e0e0e0" stroke-width="20" /> <circle id="behaviorProgress" class="progress-circle" cx="100" cy="100" r="80" fill="none" stroke="#764ba2" stroke-width="20" stroke-dasharray="502" stroke-dashoffset="502" stroke-linecap="round" />
       </svg>
       <div class="progress-text" id="behaviorScore">
        0%
       </div>
      </div>
      <h3 style="margin-top: 3%; margin-bottom: 2%;">â­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ©</h3>
      <div class="achievement-list" id="behaviorList">
       <div class="empty-state">
        <div class="empty-state-icon">
         â­
        </div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø³Ù„ÙˆÙƒÙŠØ© Ø¨Ø¹Ø¯</p>
       </div>
      </div>
     </div>
    </div><!-- ØµÙØ­Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ -->
    <div id="communicationPage" class="page">
     <div class="card">
      <h2 id="predictionLabel">ğŸ”„ Ù…Ø­ÙˆØ± Ø§Ù„ØªÙˆØ§ØµÙ„</h2>
      <div style="text-align: center; margin: 3% 0;">
       <h3>Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ</h3>
       <div class="prediction-bar">
        <div class="prediction-fill" id="predictionFill" style="width: 0%;"><span id="predictionValue">0%</span>
        </div>
       </div>
       <div class="trend-indicator" id="trendIndicator">
        â†’ 0%
       </div>
      </div>
      <div class="stats-grid">
       <div class="stat-item">
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        </div>
        <div class="stat-value" id="totalAchievements">
         0
        </div>
       </div>
       <div class="stat-item">
        <div class="stat-label">
         Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙƒÙ„ÙŠ
        </div>
        <div class="stat-value" id="overallAvg">
         0%
        </div>
       </div>
      </div>
      <h3 style="margin-top: 4%; margin-bottom: 2%;">ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©</h3>
      <div class="message-templates"><button class="template-btn" onclick="useTemplate('congratulation')">ğŸ‰ ØªÙ‡Ù†Ø¦Ø©</button> <button class="template-btn" onclick="useTemplate('alert')">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡</button> <button class="template-btn" onclick="useTemplate('followup')">ğŸ“‹ Ù…ØªØ§Ø¨Ø¹Ø©</button> <button class="template-btn" onclick="useTemplate('appreciation')">ğŸ’ Ø´ÙƒØ±</button> <button class="template-btn" onclick="useTemplate('inquiry')">â“ Ø§Ø³ØªÙØ³Ø§Ø±</button> <button class="template-btn" onclick="useTemplate('meeting')">ğŸ“… Ø¯Ø¹ÙˆØ© Ù„Ù‚Ø§Ø¡</button>
      </div>
      <form id="messageForm">
       <div class="form-group"><label for="messageCategory">ØªØµÙ†ÙŠÙ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label> <select id="messageCategory" required> <option value="inquiry">â“ Ø§Ø³ØªÙØ³Ø§Ø±</option> <option value="behavior">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø³Ù„ÙˆÙƒÙŠ</option> <option value="academic">ğŸ“š ØªÙ†Ø¨ÙŠÙ‡ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</option> <option value="appreciation">ğŸŒŸ Ø´ÙƒØ± ÙˆØªÙ‚Ø¯ÙŠØ±</option> </select>
       </div>
       <div class="form-group"><label for="messageSender">Ø§Ù„Ù…Ø±Ø³Ù„</label> <select id="messageSender" required> <option value="teacher">ğŸ‘©â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</option> <option value="parent">ğŸ‘¤ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</option> </select>
       </div>
       <div class="form-group"><label for="messageText">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label> <textarea id="messageText" rows="8" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‡Ù†Ø§..." required></textarea>
       </div><button type="submit" class="btn" id="sendMessageBtn"> <span id="sendBtnText">ğŸ“¤ Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„</span>
        <div class="loading-spinner" id="messageSendSpinner"></div></button>
       <div class="share-buttons"><button type="button" class="btn" onclick="shareViaWhatsApp()"> ğŸ’¬ Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ </button> <button type="button" class="btn" onclick="shareViaMadrasati()"> ğŸŒ Ù†Ø³Ø® ÙˆÙ†Ø´Ø± ÙÙŠ Ù…Ø¯Ø±Ø³ØªÙŠ </button>
       </div>
      </form>
      <h3 style="margin-top: 5%; margin-bottom: 2%;">ğŸ’Œ Ø³Ø¬Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h3>
      <div class="message-tabs">
       <div class="msg-tab active" onclick="switchMessageTab('all')">
        Ø§Ù„ÙƒÙ„
       </div>
       <div class="msg-tab" onclick="switchMessageTab('inquiry')">
        â“ Ø§Ø³ØªÙØ³Ø§Ø±
       </div>
       <div class="msg-tab" onclick="switchMessageTab('behavior')">
        âš ï¸ Ø³Ù„ÙˆÙƒÙŠ
       </div>
       <div class="msg-tab" onclick="switchMessageTab('academic')">
        ğŸ“š Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ
       </div>
       <div class="msg-tab" onclick="switchMessageTab('appreciation')">
        ğŸŒŸ Ø´ÙƒØ±
       </div>
      </div>
      <div id="messagesList">
       <div class="empty-state">
        <div class="empty-state-icon">
         ğŸ’Œ
        </div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯</p>
       </div>
      </div>
      <h3 style="margin-top: 5%; margin-bottom: 2%;">ğŸ“ˆ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
      <div class="achievement-list" id="allAchievementsList">
       <div class="empty-state">
        <div class="empty-state-icon">
         ğŸ“ˆ
        </div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ø¹Ø¯</p>
       </div>
      </div>
     </div>
    </div><!-- ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø¥Ù†Ø¬Ø§Ø² -->
    <div id="addPage" class="page">
     <div class="card">
      <h2>â• Ø¥Ø¶Ø§ÙØ© Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯</h2>
      <div class="add-achievement-form">
       <form id="achievementForm">
        <div class="form-group"><label for="achievementStudentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label> <input type="text" id="achievementStudentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" required>
        </div>
        <div class="form-group"><label for="category">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</label> <select id="category" required> <option value="test">ğŸ“ Ø§Ø®ØªØ¨Ø§Ø±</option> <option value="task">âœï¸ Ù…Ù‡Ù…Ø© Ø£Ø¯Ø§Ø¦ÙŠØ©</option> <option value="behavior">ğŸŒŸ ØªÙ‚ÙŠÙŠÙ… Ø³Ù„ÙˆÙƒÙŠ</option> </select>
        </div>
        <div class="form-group"><label for="achievementType">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</label> <input type="text" id="achievementType" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„" required>
        </div>
        <div class="form-group"><label for="score">Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ù† 100)</label> <input type="number" id="score" min="0" max="100" placeholder="0-100" required>
        </div>
        <div class="form-group"><label for="date">Ø§Ù„ØªØ§Ø±ÙŠØ®</label> <input type="date" id="date" required>
        </div>
        <div class="form-group"><label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label> <textarea id="notes" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
        </div><button type="submit" class="btn" id="submitBtn"> <span id="btnText">âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
         <div class="loading-spinner" id="loadingSpinner"></div></button>
       </form>
      </div>
     </div>
    </div>
   </main>
  </div>
  <script>
    const defaultConfig = {
      dashboard_title: "Ø§Ù„Ù…Ù†ØµÙ‘Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©: ØªØ­Ù„ÙŠÙ„ â€“ ØªØ´Ø®ÙŠØµ â€“ ØªÙˆØ§ØµÙ„",
      student_label: "Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨",
      academic_label: "ğŸ“Š Ù…Ø­ÙˆØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„",
      behavior_label: "ğŸ’¬ Ù…Ø­ÙˆØ± Ø§Ù„ØªØ´Ø®ÙŠØµ",
      prediction_label: "ğŸ”„ Ù…Ø­ÙˆØ± Ø§Ù„ØªÙˆØ§ØµÙ„",
      primary_color: "#667eea",
      secondary_color: "#764ba2",
      background_color: "#f8f9ff",
      text_color: "#333333",
      accent_color: "#f5576c"
    };

    let currentAchievements = [];
    let recordCount = 0;
    let currentPage = 'overview';
    let currentMessageFilter = 'all';

    const messageTemplates = {
      congratulation: {
        category: 'appreciation',
        text: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡\n\nÙŠØ³Ø¹Ø¯Ù†ÙŠ Ø£Ù† Ø£Ù‡Ù†Ø¦ÙƒÙ… Ø¨ØªÙÙˆÙ‚ Ø§Ø¨Ù†ÙƒÙ…/Ø§Ø¨Ù†ØªÙƒÙ… ÙÙŠ [Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±/Ø§Ù„Ù…Ù‡Ù…Ø©]. Ù„Ù‚Ø¯ Ø£Ø¸Ù‡Ø±/Øª Ù…Ø³ØªÙˆÙ‰ Ù…ØªÙ…ÙŠØ²Ø§Ù‹ ÙˆØ­ØµÙ„/Øª Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø© [Ø§Ù„Ø¯Ø±Ø¬Ø©].\n\nÙ†ÙØ®Ø± Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ÙˆÙ†ØªÙ…Ù†Ù‰ Ù„Ù‡/Ù‡Ø§ Ø¯ÙˆØ§Ù… Ø§Ù„ØªÙˆÙÙŠÙ‚.\n\nÙ…Ø¹ Ø®Ø§Ù„Øµ Ø§Ù„ØªØ­ÙŠØ§Øª\nØ§Ù„Ù…Ø¹Ù„Ù…Ø©'
      },
      alert: {
        category: 'behavior',
        text: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡\n\nØ£ÙˆØ¯ Ù„ÙØª Ø§Ù†ØªØ¨Ø§Ù‡ÙƒÙ… Ø¥Ù„Ù‰ [ÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ù/Ø§Ù„Ø³Ù„ÙˆÙƒ]. Ù†Ø±Ø¬Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ù…Ù†Ø§Ù‚Ø´Ø© Ø§Ù„Ø£Ù…Ø± ÙˆÙˆØ¶Ø¹ Ø®Ø·Ø© Ù…Ù†Ø§Ø³Ø¨Ø©.\n\nÙ†Ù‚Ø¯Ø± ØªØ¹Ø§ÙˆÙ†ÙƒÙ… Ø§Ù„Ù…Ø³ØªÙ…Ø±.\n\nÙ…Ø¹ Ø§Ù„ØªØ­ÙŠØ©\nØ§Ù„Ù…Ø¹Ù„Ù…Ø©'
      },
      followup: {
        category: 'academic',
        text: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡\n\nÙ…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø®Ø·Ø© Ø§Ù„Ø¹Ù„Ø§Ø¬ÙŠØ© Ù„Ø§Ø¨Ù†ÙƒÙ…/Ø§Ø¨Ù†ØªÙƒÙ… ÙÙŠ Ù…Ø§Ø¯Ø© [Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©]:\n\n- Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ù„Ø­ÙˆØ¸: [ÙˆØµÙ Ø§Ù„ØªÙ‚Ø¯Ù…]\n- Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†: [Ø§Ù„Ù†Ù‚Ø§Ø·]\n- Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: [Ø§Ù„Ø®Ø·ÙˆØ§Øª]\n\nÙ†Ø´ÙƒØ± ØªØ¹Ø§ÙˆÙ†ÙƒÙ… ÙˆÙ…ØªØ§Ø¨Ø¹ØªÙƒÙ… Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©.\n\nÙ…Ø¹ Ø§Ù„ØªØ­ÙŠØ©\nØ§Ù„Ù…Ø¹Ù„Ù…Ø©'
      },
      appreciation: {
        category: 'appreciation',
        text: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡\n\nØ£ØªÙ‚Ø¯Ù… Ø¨Ø®Ø§Ù„Øµ Ø§Ù„Ø´ÙƒØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ± Ù„ØªØ¹Ø§ÙˆÙ†ÙƒÙ… Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙˆÙ…ØªØ§Ø¨Ø¹ØªÙƒÙ… Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø§Ø¨Ù†ÙƒÙ…/Ø§Ø¨Ù†ØªÙƒÙ…. Ù‡Ø°Ø§ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ù„Ù‡ Ø£Ø«Ø± Ø¥ÙŠØ¬Ø§Ø¨ÙŠ ÙˆØ§Ø¶Ø­ Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¦Ù‡/Ù‡Ø§.\n\nØ¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠÙƒÙ… ÙˆÙÙŠ Ø¬Ù‡ÙˆØ¯ÙƒÙ….\n\nÙ…Ø¹ Ø®Ø§Ù„Øµ Ø§Ù„ØªØ­ÙŠØ§Øª\nØ§Ù„Ù…Ø¹Ù„Ù…Ø©'
      },
      inquiry: {
        category: 'inquiry',
        text: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡\n\nØ£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† [Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±]. Ù†Ø±Ø¬Ùˆ Ø§Ù„ØªÙƒØ±Ù… Ø¨ØªØ²ÙˆÙŠØ¯Ù†Ø§ Ø¨Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©.\n\nØ´Ø§ÙƒØ±ÙŠÙ† ØªØ¹Ø§ÙˆÙ†ÙƒÙ….\n\nÙ…Ø¹ Ø§Ù„ØªØ­ÙŠØ©\nØ§Ù„Ù…Ø¹Ù„Ù…Ø©'
      },
      meeting: {
        category: 'inquiry',
        text: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡\n\nÙ†Ø¯Ø¹ÙˆÙƒÙ… Ù„Ø­Ø¶ÙˆØ± Ù„Ù‚Ø§Ø¡ Ø®Ø§Øµ Ù„Ù…Ù†Ø§Ù‚Ø´Ø© Ø£Ø¯Ø§Ø¡ Ø§Ø¨Ù†ÙƒÙ…/Ø§Ø¨Ù†ØªÙƒÙ… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ÙˆØ§Ù„Ø³Ù„ÙˆÙƒÙŠ.\n\nØ§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ù‚ØªØ±Ø­: [Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª]\nØ§Ù„Ù…ÙƒØ§Ù†: [Ø§Ù„Ù…ÙƒØ§Ù†]\n\nÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±.\n\nÙ…Ø¹ Ø§Ù„ØªØ­ÙŠØ©\nØ§Ù„Ù…Ø¹Ù„Ù…Ø©'
      }
    };

    const dataHandler = {
      onDataChanged(data) {
        currentAchievements = data;
        recordCount = data.length;
        updateAllPages(data);
      }
    };

    async function initializeDashboard() {
      const result = await window.dataSdk.init(dataHandler);
      if (!result.isOk) {
        console.error("Failed to initialize Data SDK");
      }
    }

    function navigateToPage(pageName) {
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      
      const pageMap = {
        'overview': 'overviewPage',
        'analysis': 'analysisPage',
        'diagnosis': 'diagnosisPage',
        'communication': 'communicationPage',
        'add': 'addPage'
      };
      
      document.getElementById(pageMap[pageName]).classList.add('active');
      
      const navItems = document.querySelectorAll('.nav-item');
      const navIndex = ['overview', 'analysis', 'diagnosis', 'communication', 'add'].indexOf(pageName);
      if (navIndex !== -1) {
        navItems[navIndex].classList.add('active');
      }
      
      currentPage = pageName;
    }

    function useTemplate(templateName) {
      const template = messageTemplates[templateName];
      if (template) {
        document.getElementById('messageCategory').value = template.category;
        document.getElementById('messageText').value = template.text;
      }
    }

    function switchMessageTab(filter) {
      currentMessageFilter = filter;
      document.querySelectorAll('.msg-tab').forEach(tab => tab.classList.remove('active'));
      event.target.closest('.msg-tab').classList.add('active');
      renderMessages(currentAchievements);
    }

    function renderMessages(data) {
      const messages = data.filter(item => item.message_type === 'message');
      let filteredMessages = messages;

      if (currentMessageFilter !== 'all') {
        filteredMessages = messages.filter(msg => msg.message_category === currentMessageFilter);
      }

      const container = document.getElementById('messagesList');

      if (filteredMessages.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ’Œ</div>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ</p>
          </div>
        `;
        return;
      }

      const sortedMessages = [...filteredMessages].sort((a, b) => new Date(b.date) - new Date(a.date));

      container.innerHTML = sortedMessages.map(msg => {
        const categoryIcons = {
          inquiry: 'â“',
          behavior: 'âš ï¸',
          academic: 'ğŸ“š',
          appreciation: 'ğŸŒŸ'
        };

        const categoryNames = {
          inquiry: 'Ø§Ø³ØªÙØ³Ø§Ø±',
          behavior: 'ØªÙ†Ø¨ÙŠÙ‡ Ø³Ù„ÙˆÙƒÙŠ',
          academic: 'ØªÙ†Ø¨ÙŠÙ‡ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ',
          appreciation: 'Ø´ÙƒØ± ÙˆØªÙ‚Ø¯ÙŠØ±'
        };

        const senderIcon = msg.sender === 'teacher' ? 'ğŸ‘©â€ğŸ«' : 'ğŸ‘¤';
        const senderName = msg.sender === 'teacher' ? 'Ø§Ù„Ù…Ø¹Ù„Ù…Ø©' : 'ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±';

        return `
          <div class="message-item ${msg.read ? '' : 'unread'}">
            <div class="message-header">
              <span class="message-category-badge ${msg.message_category}">
                ${categoryIcons[msg.message_category]} ${categoryNames[msg.message_category]}
              </span>
              <span class="message-sender">
                ${senderIcon} ${senderName}
              </span>
            </div>
            <div class="message-text">${msg.message_text}</div>
            <div class="message-footer">
              <span>${new Date(msg.date).toLocaleDateString('ar-SA', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
              <button class="delete-message-btn" onclick="deleteMessage('${msg.__backendId}')">
                ğŸ—‘ï¸ Ø­Ø°Ù
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    async function deleteMessage(id) {
      const message = currentAchievements.find(a => a.__backendId === id);
      if (!message) return;

      const result = await window.dataSdk.delete(message);
      
      if (!result.isOk) {
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
      }
    }

    function shareViaWhatsApp() {
      const messageText = document.getElementById('messageText').value;
      if (!messageText.trim()) {
        showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
      }

      const studentName = document.getElementById('studentName').textContent;
      const fullMessage = `Ø±Ø³Ø§Ù„Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø·Ø§Ù„Ø¨: ${studentName}\n\n${messageText}`;
      const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(fullMessage)}`;
      window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
    }

    function shareViaMadrasati() {
      const messageText = document.getElementById('messageText').value;
      if (!messageText.trim()) {
        showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
      }

      showMessage('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù„ØµÙ‚Ù‡Ø§ ÙÙŠ Ù…Ù†ØµØ© Ù…Ø¯Ø±Ø³ØªÙŠ', 'success');
      
      navigator.clipboard.writeText(messageText).then(() => {
        window.open('https://schools.madrasati.sa', '_blank', 'noopener,noreferrer');
      }).catch(() => {
        const textArea = document.createElement('textarea');
        textArea.value = messageText;
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        window.open('https://schools.madrasati.sa', '_blank', 'noopener,noreferrer');
      });
    }

    document.getElementById('messageForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      if (recordCount >= 999) {
        showMessage('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (999 Ø³Ø¬Ù„). ÙŠØ±Ø¬Ù‰ Ø­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.', 'error');
        return;
      }

      const submitBtn = document.getElementById('sendMessageBtn');
      const btnText = document.getElementById('sendBtnText');
      const spinner = document.getElementById('messageSendSpinner');
      
      submitBtn.disabled = true;
      btnText.style.display = 'none';
      spinner.style.display = 'block';

      const formData = {
        id: Date.now().toString(),
        message_type: 'message',
        message_category: document.getElementById('messageCategory').value,
        message_text: document.getElementById('messageText').value,
        sender: document.getElementById('messageSender').value,
        date: new Date().toISOString(),
        read: false,
        student_name: document.getElementById('studentName').textContent,
        target_student_name: document.getElementById('studentName').textContent
      };

      const result = await window.dataSdk.create(formData);

      submitBtn.disabled = false;
      btnText.style.display = 'inline';
      spinner.style.display = 'none';

      if (result.isOk) {
        e.target.reset();
        showMessage('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
      } else {
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
      }
    });

    function renderTestScores(tests) {
      const container = document.getElementById('testScoresList');
      
      if (tests.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>
          </div>
        `;
        return;
      }

      const sortedTests = [...tests].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      container.innerHTML = sortedTests.map(test => `
        <div class="score-card">
          <p class="score-card-title" title="${test.achievement_type}">${test.achievement_type}</p>
          <p class="score-card-value">${test.score}</p>
          <p class="score-card-date">${new Date(test.date).toLocaleDateString('ar-SA', { month: 'short', day: 'numeric' })}</p>
        </div>
      `).join('');
    }

    function updateAllPages(data) {
      const tests = data.filter(a => a.category === 'test' && !a.message_type);
      const tasks = data.filter(a => a.category === 'task' && !a.message_type);
      const behavior = data.filter(a => a.category === 'behavior' && !a.message_type);
      const academic = [...tests, ...tasks];

      const testsAvg = tests.length > 0 
        ? Math.round(tests.reduce((sum, a) => sum + a.score, 0) / tests.length) 
        : 0;
      
      const tasksAvg = tasks.length > 0 
        ? Math.round(tasks.reduce((sum, a) => sum + a.score, 0) / tasks.length) 
        : 0;

      const academicAvg = academic.length > 0 
        ? Math.round(academic.reduce((sum, a) => sum + a.score, 0) / academic.length)
        : 0;
      
      const behaviorAvg = behavior.length > 0 
        ? Math.round(behavior.reduce((sum, a) => sum + a.score, 0) / behavior.length) 
        : 0;

      const overallAvg = data.length > 0
        ? Math.round(data.reduce((sum, a) => sum + a.score, 0) / data.length)
        : 0;

      document.getElementById('testsCount').textContent = tests.length;
      document.getElementById('testsAvg').textContent = testsAvg;
      document.getElementById('tasksCount').textContent = tasks.length;
      document.getElementById('tasksAvg').textContent = tasksAvg;
      document.getElementById('academicScore').textContent = academicAvg + '%';
      updateProgressCircle('academicProgress', academicAvg, 502);

      renderTestScores(tests);

      document.getElementById('behaviorCount').textContent = behavior.length;
      document.getElementById('behaviorAvg').textContent = behaviorAvg;
      document.getElementById('behaviorScore').textContent = behaviorAvg + '%';
      updateProgressCircle('behaviorProgress', behaviorAvg, 502);

      const prediction = calculatePrediction(data);
      document.getElementById('predictionValue').textContent = prediction + '%';
      document.getElementById('predictionFill').style.width = prediction + '%';
      
      const trend = calculateTrend(data);
      const trendEl = document.getElementById('trendIndicator');
      if (trend > 0) {
        trendEl.className = 'trend-indicator trend-up';
        trendEl.textContent = 'â†—ï¸ +' + trend + '%';
      } else if (trend < 0) {
        trendEl.className = 'trend-indicator trend-down';
        trendEl.textContent = 'â†˜ï¸ ' + trend + '%';
      } else {
        trendEl.className = 'trend-indicator';
        trendEl.textContent = 'â†’ ' + trend + '%';
      }

      document.getElementById('totalAchievements').textContent = data.length;
      document.getElementById('overallAvg').textContent = overallAvg + '%';

      document.getElementById('overviewAcademicScore').textContent = academicAvg + '%';
      document.getElementById('overviewAcademicCount').textContent = academic.length;
      document.getElementById('overviewBehaviorScore').textContent = behaviorAvg + '%';
      document.getElementById('overviewBehaviorCount').textContent = behavior.length;
      document.getElementById('overviewPrediction').textContent = prediction + '%';
      document.getElementById('overviewTotal').textContent = data.length;

      renderAchievements(academic, 'academicList', 'ğŸ“š', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø¨Ø¹Ø¯');
      renderAchievements(behavior, 'behaviorList', 'â­', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø³Ù„ÙˆÙƒÙŠØ© Ø¨Ø¹Ø¯');
      
      const allAchievements = data.filter(item => !item.message_type);
      renderAchievements(allAchievements, 'allAchievementsList', 'ğŸ“ˆ', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ø¹Ø¯');
      
      const sortedRecent = [...allAchievements].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
      renderAchievements(sortedRecent, 'recentAchievements', 'ğŸ“', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯');

      renderMessages(data);
    }

    function updateProgressCircle(elementId, percentage, circumference) {
      const circle = document.getElementById(elementId);
      const offset = circumference - (percentage / 100) * circumference;
      circle.style.strokeDashoffset = offset;
    }

    function calculatePrediction(data) {
      if (data.length === 0) return 0;
      
      const sortedData = [...data].sort((a, b) => new Date(a.date) - new Date(b.date));
      const recentData = sortedData.slice(-5);
      
      if (recentData.length < 2) {
        return Math.round(recentData.reduce((sum, a) => sum + a.score, 0) / recentData.length);
      }

      const weights = recentData.map((_, i) => i + 1);
      const totalWeight = weights.reduce((sum, w) => sum + w, 0);
      
      const weightedAvg = recentData.reduce((sum, achievement, i) => {
        return sum + (achievement.score * weights[i]);
      }, 0) / totalWeight;

      return Math.min(100, Math.max(0, Math.round(weightedAvg)));
    }

    function calculateTrend(data) {
      if (data.length < 2) return 0;
      
      const sortedData = [...data].sort((a, b) => new Date(a.date) - new Date(b.date));
      const recent = sortedData.slice(-3);
      const previous = sortedData.slice(-6, -3);
      
      if (previous.length === 0) return 0;
      
      const recentAvg = recent.reduce((sum, a) => sum + a.score, 0) / recent.length;
      const previousAvg = previous.reduce((sum, a) => sum + a.score, 0) / previous.length;
      
      return Math.round(recentAvg - previousAvg);
    }

    function renderAchievements(data, containerId, emptyIcon, emptyText) {
      const container = document.getElementById(containerId);
      
      if (data.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">${emptyIcon}</div>
            <p>${emptyText}</p>
          </div>
        `;
        return;
      }

      const sortedData = [...data].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      container.innerHTML = sortedData.map(achievement => {
        let categoryLabel = '';
        let categoryIcon = '';
        if (achievement.category === 'test') {
          categoryLabel = 'Ø§Ø®ØªØ¨Ø§Ø±';
          categoryIcon = 'ğŸ“';
        } else if (achievement.category === 'task') {
          categoryLabel = 'Ù…Ù‡Ù…Ø© Ø£Ø¯Ø§Ø¦ÙŠØ©';
          categoryIcon = 'âœï¸';
        } else if (achievement.category === 'behavior') {
          categoryLabel = 'Ø³Ù„ÙˆÙƒÙŠ';
          categoryIcon = 'ğŸŒŸ';
        }
        
        return `
          <div class="achievement-item" data-id="${achievement.__backendId}">
            <div class="achievement-info">
              <h4>${categoryIcon} ${achievement.achievement_type}</h4>
              <p>ğŸ‘¨â€ğŸ“ ${achievement.student_name || achievement.target_student_name || 'Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨'} â€¢ ${new Date(achievement.date).toLocaleDateString('ar-SA')} â€¢ ${categoryLabel}</p>
              ${achievement.notes ? `<p style="margin-top: 1%; color: #999; font-size: 0.85em;">${achievement.notes}</p>` : ''}
            </div>
            <div style="display: flex; align-items: center;">
              <button class="btn btn-delete" onclick="deleteAchievement('${achievement.__backendId}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
              <div class="achievement-score">${achievement.score}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    async function deleteAchievement(id) {
      const achievement = currentAchievements.find(a => a.__backendId === id);
      if (!achievement) return;

      const itemEls = document.querySelectorAll(`[data-id="${id}"]`);
      itemEls.forEach(el => el.style.opacity = '0.5');

      const result = await window.dataSdk.delete(achievement);
      
      if (!result.isOk) {
        itemEls.forEach(el => el.style.opacity = '1');
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²', 'error');
      }
    }

    function showMessage(text, type) {
      const messageDiv = document.createElement('div');
      messageDiv.textContent = text;
      messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: ${type === 'error' ? '#f5576c' : '#4caf50'};
        color: white;
        padding: 15px 30px;
        border-radius: 10px;
        z-index: 1000;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      `;
      document.body.appendChild(messageDiv);
      setTimeout(() => messageDiv.remove(), 3000);
    }

    document.getElementById('achievementForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      if (recordCount >= 999) {
        showMessage('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (999 Ø¥Ù†Ø¬Ø§Ø²). ÙŠØ±Ø¬Ù‰ Ø­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.', 'error');
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      const btnText = document.getElementById('btnText');
      const spinner = document.getElementById('loadingSpinner');
      
      submitBtn.disabled = true;
      btnText.style.display = 'none';
      spinner.style.display = 'block';

      const formData = {
        id: Date.now().toString(),
        student_name: document.getElementById('achievementStudentName').value,
        achievement_type: document.getElementById('achievementType').value,
        category: document.getElementById('category').value,
        score: parseInt(document.getElementById('score').value),
        date: new Date(document.getElementById('date').value).toISOString(),
        notes: document.getElementById('notes').value,
        target_student_name: document.getElementById('achievementStudentName').value
      };

      const result = await window.dataSdk.create(formData);

      submitBtn.disabled = false;
      btnText.style.display = 'inline';
      spinner.style.display = 'none';

      if (result.isOk) {
        e.target.reset();
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        showMessage('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        navigateToPage('overview');
      } else {
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²', 'error');
      }
    });

    async function onConfigChange(config) {
      const dashboardTitle = config.dashboard_title || defaultConfig.dashboard_title;
      const studentLabel = config.student_label || defaultConfig.student_label;
      const academicLabel = config.academic_label || defaultConfig.academic_label;
      const behaviorLabel = config.behavior_label || defaultConfig.behavior_label;
      const predictionLabel = config.prediction_label || defaultConfig.prediction_label;

      document.getElementById('dashboardTitle').textContent = dashboardTitle;
      document.getElementById('studentName').textContent = studentLabel;
      document.getElementById('academicLabel').textContent = academicLabel;
      document.getElementById('behaviorLabel').textContent = behaviorLabel;
      document.getElementById('predictionLabel').textContent = predictionLabel;

      document.getElementById('navAnalysis').textContent = academicLabel.replace('ğŸ“Š ', '');
      document.getElementById('navDiagnosis').textContent = behaviorLabel.replace('ğŸ’¬ ', '');
      document.getElementById('navCommunication').textContent = predictionLabel.replace('ğŸ”„ ', '');

      document.getElementById('overviewAnalysisTitle').textContent = academicLabel;
      document.getElementById('overviewDiagnosisTitle').textContent = behaviorLabel;
      document.getElementById('overviewCommunicationTitle').textContent = predictionLabel;

      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;

      document.body.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      document.querySelector('.header h1').style.color = primaryColor;
      document.querySelector('.student-avatar').style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      document.getElementById('academicProgress').style.stroke = primaryColor;
      document.getElementById('behaviorProgress').style.stroke = secondaryColor;
      
      document.querySelectorAll('.progress-text').forEach(el => {
        el.style.color = primaryColor;
      });

      document.querySelectorAll('.stat-value, .overview-stat-value').forEach(el => {
        el.style.color = primaryColor;
      });

      document.querySelectorAll('.stat-item, .achievement-item').forEach(el => {
        el.style.background = backgroundColor;
      });

      document.querySelector('.add-achievement-form').style.background = backgroundColor;

      document.querySelectorAll('.card h2, .achievement-info h4, .overview-card h3').forEach(el => {
        el.style.color = textColor;
      });

      document.querySelectorAll('.btn').forEach(btn => {
        if (!btn.classList.contains('btn-delete')) {
          btn.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
        }
      });

      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.style.background = `linear-gradient(135deg, ${accentColor} 0%, #f093fb 100%)`;
      });

      document.querySelectorAll('.achievement-score').forEach(el => {
        el.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      });

      document.querySelectorAll('.score-card').forEach(el => {
        el.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      });
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            },
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => {
                config.accent_color = value;
                window.elementSdk.setConfig({ accent_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["dashboard_title", config.dashboard_title || defaultConfig.dashboard_title],
          ["student_label", config.student_label || defaultConfig.student_label],
          ["academic_label", config.academic_label || defaultConfig.academic_label],
          ["behavior_label", config.behavior_label || defaultConfig.behavior_label],
          ["prediction_label", config.prediction_label || defaultConfig.prediction_label]
        ])
      });
    }

    document.getElementById('date').value = new Date().toISOString().split('T')[0];
    
    initializeDashboard();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9abb33e7842c9359',t:'MTc2NTM1MzU2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
